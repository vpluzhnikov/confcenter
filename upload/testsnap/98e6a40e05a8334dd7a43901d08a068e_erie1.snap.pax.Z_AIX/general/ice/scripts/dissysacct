# IBM_PROLOG_BEGIN_TAG         
# This is an automatically generated prolog.  
#                            
# $Source: aix710 bos/usr/lib/security/ice/scripts/dissysacct.sh 1$                         
#                                                           
# COPYRIGHT International Business Machines Corp. 2010,2010              
#                                                                      
# Pvalue: p2 
#Licensed Materials - Property of IBM
#
#Restricted Materials of IBM
#
#US Government Users Restricted Rights - Use, duplication or
#disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
#
# Origin: 27
#
# sccsid: $Header: @(#) AIX710_area/1 bos/usr/lib/security/ice/scripts/dissysacct.sh, libice, aix710, 1020A_710 2010-05-12T16:23:54-05:00$
#
# IBM_PROLOG_END_TAG
#!/usr/bin/ksh

#GEN002640

INSTALLDIR=/etc/security/ice/scripts
. $INSTALLDIR/iceInit

PREREQ_LIST="bos.rte.security,bos.rte.date,bos.rte.ILS"

checkPrereq

SYSACCOUNT="daemon bin sys adm uucp guest nobody lpd lp invscout snapp ipsec nuucp pconsole esaadmin sshd"
PASSWDFILE=/etc/passwd

###########
# Checking
###########
if [[ cflag -eq 1 ]];
then
	for ACCOUNT in $SYSACCOUNT
	do
		if [ `grep -c "^$ACCOUNT" $PASSWDFILE` -gt 0 ]
		then
			lockcnt=`/usr/sbin/lsuser -a account_locked $ACCOUNT | grep -c "true"`
			shellcnt=`/usr/sbin/lsuser -a shell $ACCOUNT | grep -c "false"`
			if [ $lockcnt -gt 0 -o $shellcnt -eq 0 ]
			then
				if [ "$STATUS_ARG" = "false" ]
				then
					print "$ACCOUNT account is locked or has valid shell." >> log_msg 2>&1
					ice_status=2
					Script_Output
					exit 0
				fi
			else
				if [ "$STATUS_ARG" = "true" ]
				then
					print "$ACCOUNT account is not locked or has false shell." >> log_msg 2>&1
					ice_status=2
					Script_Output
					exit 0
				fi
			fi
		fi
	done
	Script_Output
	exit 0
fi

####################
# Preview/Enforcing
####################
cur_val=
print "This rule does not support -e option." >> log_msg 2>&1
Script_Output
exit 0
