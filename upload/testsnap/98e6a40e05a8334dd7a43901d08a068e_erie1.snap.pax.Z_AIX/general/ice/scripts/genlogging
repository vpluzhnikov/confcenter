# IBM_PROLOG_BEGIN_TAG         
# This is an automatically generated prolog.  
#                            
# $Source: aix710 bos/usr/lib/security/ice/scripts/genlogging.sh 1$                         
#                                                           
# COPYRIGHT International Business Machines Corp. 2010,2010              
#                                                                      
# Pvalue: p2 
#Licensed Materials - Property of IBM
#
#Restricted Materials of IBM
#
#US Government Users Restricted Rights - Use, duplication or
#disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
#
# Origin: 27
#
# sccsid: $Header: @(#) AIX710_area/1 bos/usr/lib/security/ice/scripts/genlogging.sh, libice, aix710, 1020A_710 2010-05-03T14:25:50-05:00$
#
# IBM_PROLOG_END_TAG
#!/usr/bin/ksh

#GEN003160
#GEN001060
#GEN003640 	- Not applicable for AIX as indicated in the document 
#			- that JFS has logging as default.  


INSTALLDIR=/etc/security/ice/scripts
. $INSTALLDIR/iceInit

PREREQ_LIST="bos.rte.security,bos.rte.date,bos.rte.ILS"

checkPrereq

CRONLOGFILE=/var/adm/cron/log
SULOG=/var/adm/sulog

###########
# Checking
###########
if [[ cflag -eq 1 ]];
then
	#GEN003160
	#To stop log, need to run "cron -Q".  The cron deamon is set
	#in /etc/inittab with respawn.  May not want to touch inittab
	#unless there is a request for it.
	if [ -s $CRONLOGFILE ]
	then
		if [ "$STATUS_ARG" = "false" ]
		then
			cur_val=1
			print "Cron is logging." >> log_msg 2>&1
			ice_status=2
			Script_Output
			exit 0
		fi
	else
		if [ "$STATUS_ARG" = "true" ]
		then
			print "Cron is not logging." >> log_msg 2>&1
			ice_status=2
			Script_Output
			exit 0
		fi		
	fi

	#GEN001060
	if [ `grep -c root $SULOG` -gt 0 ]
	then
		if [ "$STATUS_ARG" = "false" ]
		then
			cur_val=1
			print "root login is logging." >> log_msg 2>&1
			ice_status=2
			Script_Output
			exit 0
		fi
	else
		if [ "$STATUS_ARG" = "true" ]
		then
			#run this command to generate an entry in SULOG 
			#must be running as root to avoid password prompt
			su root "-c ls" 1>/dev/null
			if [ `grep -c root $SULOG` -eq 0 ]
			then
				cur_val=0
				print "root login is not logging." >> log_msg 2>&1
				ice_status=2
				Script_Output
				exit 0
			fi
		fi
	fi

	Script_Output
	exit 0
fi

####################
# Preview/Enforcing
####################
cur_val=
if [ "$STATUS_ARG" = "false" ]
then
	#GEN003160
	if [ -s $CRONLOGFILE ]
	then
		if [ ! -f $TMPDIR/cronlogfile ]
		then
			cp $CRONLOGFILE $TMPDIR/cronlogfile
		fi
		rm $CRONLOGFILE
		touch $CRONLOGFILE
	fi

	#GEN001060
	#Cannot find documentation to turn su log on/off.
	if [ `grep -c root $SULOG` -gt 0 ]
	then
		if [ ! -f $TMPDIR/sulog ]
		then
			cp $SULOG $TMPDIR/sulog
		fi
		rm $SULOG 
		touch $SULOG 
	fi
else
	if [ "$STATUS_ARG" = "true" ]
	then
		#GEN003160
		if [ ! -s $CRONLOGFILE ]
		then
			touch $CRONLOGFILE
			echo "*** Begin log ***" > $CRONLOGFILE
		fi
		
		#GEN001060
		if [ `grep -c root $SULOG` -eq 0 ]
		then
			#run this command to generate an entry in SULOG 
			#must be running as root to avoid password prompt
			su root "-c ls" 1>/dev/null
		fi
	fi
	Script_Output
	exit 0
fi
