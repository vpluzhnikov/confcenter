#!/usr/bin/ksh
# IBM_PROLOG_BEGIN_TAG         
# This is an automatically generated prolog.  
#                            
# $Source: aix710 bos/usr/lib/security/ice/scripts/chkprereq.sh 1$                         
#                                                           
# COPYRIGHT International Business Machines Corp. 2010,2010              
#                                                                      
# Pvalue: p2 
#Licensed Materials - Property of IBM
#
#Restricted Materials of IBM
#
#US Government Users Restricted Rights - Use, duplication or
#disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
#
# Origin: 27
#
# sccsid: $Header: @(#) AIX710_area/1 bos/usr/lib/security/ice/scripts/chkprereq.sh, libice, aix710, 1010A_710 2010-03-02T17:22:27-06:00$
#
# IBM_PROLOG_END_TAG
#       COMPONENT_NAME: (ICE) chkprereq.sh
#       FUNCTIONS:      None
#       ORIGINS:        27
#
#       Syntax:
#               chkprereq <filesets> 
#		filesets  - Lists of software products or prereq scripts 
#
#       OUTPUT:
#               0       - success
#               1       - check/enforce failure
#               2       - usage error
#
#       Description:
#		This script checks prereq list consisting Filesets being installed or not 

export PATH=/usr/bin:/usr/sbin:$PATH

filesets=$1
prc=0
nrc=0
ICE_PATH='/etc/security/ice/scripts'
ICE_TMP='/etc/security/ice/tmp'
if [[ ! -d $ICE_TMP ]]
then
	mkdir -p $ICE_TMP
fi

IFS=","
for i in $filesets
do
	echo $i | grep \\. 2>&1 > /dev/null
	if [ $? -ne 0 ]
	then	
		if ( [[ -f $ICE_PATH/$i ]] )
		then	
			$ICE_PATH/$i -e 
       			prc=$?	
		else
			print "Script $i Not Found" 	
			prc=1
		fi 
	else 
		x=`/usr/bin/lslpp -l $i`
		if [ $? -ne 0 ]
		then
			echo $x | grep 'not installed'
			prc=1  
		fi
	fi			
	#Only keep around non-zero exit code for new-return-code	
	if [ $prc -ne 0 ]
	then
		nrc=$prc
	fi
done
exit $nrc 
